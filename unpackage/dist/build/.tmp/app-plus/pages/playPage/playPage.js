(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/playPage/playPage"],{"0527":function(e,t,a){"use strict";a.r(t);var s=a("475e"),n=a.n(s);for(var o in s)"default"!==o&&function(e){a.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},4101:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement;e._self._c},n=[];a.d(t,"a",function(){return s}),a.d(t,"b",function(){return n})},"475e":function(e,t,a){"use strict";(function(e,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(a("a34a")),o=i(a("bfa0"));function i(e){return e&&e.__esModule?e:{default:e}}function l(e,t,a,s,n,o,i){try{var l=e[o](i),c=l.value}catch(r){return void a(r)}l.done?t(c):Promise.resolve(c).then(s,n)}function c(e){return function(){var t=this,a=arguments;return new Promise(function(s,n){var o=e.apply(t,a);function i(e){l(o,s,n,i,c,"next",e)}function c(e){l(o,s,n,i,c,"throw",e)}i(void 0)})}}var r=function(){return a.e("pages/playPage/commentItem").then(a.bind(null,"0322"))},u=function(){return a.e("pages/playPage/chatinput").then(a.bind(null,"d658"))},d=function(){return a.e("pages/playPage/uni-popup").then(a.bind(null,"377a"))},h=function(){return a.e("pages/playPage/share").then(a.bind(null,"3a06"))},m=a("2088"),p={components:{commItem:r,chatinput:u,uniPopup:d,sharePage:h},onResize:function(){this.pageChangeBig?this.pageChangeBig=!1:this.bigInputBlur()},onHide:function(){this.videoContext.pause(),this.autoPlay=!1},onShow:function(){var t=e.getSystemInfoSync();this.style.pageHeight=t.windowHeight,this.style.contentViewHeight=t.windowHeight-e.getSystemInfoSync().screenWidth/750*660,this.style.detailViewHeight=t.windowHeight-e.getSystemInfoSync().screenWidth/750*540,this.style.commentViewHeight=t.windowHeight-e.getSystemInfoSync().screenWidth/750*750,this.style.allConment=t.windowHeight-e.getSystemInfoSync().screenWidth/750*540,this.$nextTick(function(){this.videoContext=e.createVideoContext("myVideo",this),this.videoContext.play()}),this.autoPlay=!0},onUnload:function(){this.autoPlay=!1},data:function(){return{scrollLeft:0,baseDateName:"98TV",baseDataSrc:"_doc/test.db",type:"",select_status:!1,playTvSrc:"",playTvImg:"",beginPlay:!1,videoToShareStatus:!1,vodId:0,allsuccessData:{},tabIndex:0,downIndex:0,collectionNum:"",pageChangeBig:!0,otherContentList:[],otherCommentListShow:!1,commentListShow:!1,currentCommentType:1,currentCommentId:0,currentCommentMid:0,currentCommentIndex:0,loadSurvey:!0,loadComplent:!1,danmuList:[],commentData:[],name:"xcecd@qq.com",style:{pageHeight:0,detailViewHeight:0,contentViewHeight:0,commentViewHeight:0,footViewHeight:90,mitemHeight:0,allConment:0},scrollTop:0,messages:[{user:"home",type:"head",content:"你好!"}],initialTime:0,currentPlayTime:0,sharingStatus:!1,isFullscreen:!1,autoPlay:!1,add_coin_works:!0,ad_center_video:!1,ad_center_video_image:!1,countDownTime:5,advertisementStatus:!1,advertArr:[]}},onLoad:function(t){var a=this;if(a.vodId=t.vodId,a.$store.state.userInfo.userId)var s=a.$store.state.userInfo.userId;else s="";a.checkIShareStatus(function(t){if(t)var n=JSON.parse(t);else n=[];n.length>0&&(a.initialTime=Number(n[0].playTime),a.sharingStatus=Boolean(n[0].isShare),n[0].partsNo&&(a.tabIndex=n[0].partsNo)),e.request({url:a.websiteUrl+"/api/home/play?vodId="+a.vodId+"&userId="+s,success:function(e){a.allsuccessData=e.data,a.allsuccessData&&(a.allsuccessData.visitInfo&&(a.initialTime=a.allsuccessData.visitInfo.playTime,a.tabIndex=a.allsuccessData.visitInfo.partsNo,a.scrollLeft=6.5*(a.tabIndex+3)),a.allsuccessData.shareStatus&&"Y"==a.allsuccessData.shareStatus&&(a.allsuccessData.vodIsShare&&"N"==a.allsuccessData.vodIsShare||a.allsuccessData.visitInfo&&a.allsuccessData.visitInfo.isShare&&"Y"==a.allsuccessData.visitInfo.isShare)&&(a.sharingStatus=!0),""==a.allsuccessData.vodPicThumb?a.playTvImg=a.allsuccessData.vodPic:a.playTvImg=a.allsuccessData.vodPicThumb,a.playTvSrc=a.allsuccessData.vodPlayUrl[a.tabIndex].playUrl,a.currentCommentMid=a.allsuccessData.typeId1,a.allsuccessData.vodPlayUrl&&a.allsuccessData.vodPlayUrl.length>1?a.select_status=!0:a.select_status=!1,a.allsuccessData.commentList?a.commentData=a.allsuccessData.commentList:a.commentData=[],a.commentData.length>0?a.commentListShow=!1:a.commentListShow=!0,a.allsuccessData.commentNum?a.loadComplent=!0:a.loadComplent=!1,a.allsuccessData.advertInfo&&(a.advertArr=a.allsuccessData.advertInfo))}})})},onBackPress:function(){this.backPress()},methods:{countDown:function(){var e=this,t=setInterval(function(){e.countDownTime<1?(clearInterval(t),e.countDownTime=5,e.ad_center_video_image=!1,e.ad_center_video=!1,e.advertisementStatus=!0,e.videoContext.play()):e.countDownTime--},1e3)},advertisement:function(){this.ad_center_video=!0,this.ad_center_video_image=!0,this.videoContext.pause(),this.countDown()},gotoWeb:function(e){var t=e.target.dataset.url;plus.runtime.openWeb(t),this.videoContext.pause()},backPress:function(){var t=this;if(this.$store.state.isLogin){var a=t.sharingStatus?"Y":"N";e.request({url:this.websiteUrl+"/user/add/visit",method:"POST",header:{Authorization:this.$store.state.userInfo.loginToken},data:{userId:Number(this.$store.state.userInfo.userId),vodId:Number(this.vodId),vodType:this.allsuccessData.typeId1,partsNo:Number(this.tabIndex),partsUrl:this.allsuccessData.vodPlayUrl[t.tabIndex].playUrl,playTime:String(t.currentPlayTime),isShare:a},success:function(e){}})}else plus.sqlite.isOpenDatabase({name:t.baseDateName,path:t.baseDataSrc})?t.executeSQL():plus.sqlite.openDatabase({name:t.baseDateName,path:t.baseDataSrc,success:function(e){console.log(s("openDatabase success!"," at pages\\playPage\\playPage.vue:392")),t.executeSQL()},fail:function(e){console.log(s("openDatabase failed: "+JSON.stringify(e)," at pages\\playPage\\playPage.vue:396"))}})},toXuanji:function(){var e=c(n.default.mark(function e(t){var a;return n.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(a=t.currentTarget.id,this.playTvSrc=this.allsuccessData.vodPlayUrl[a].playUrl,this.tabIndex!==a){e.next=6;break}return e.abrupt("return",!1);case 6:this.tabIndex=a,this.tabIndex>=5&&"selected_works"===this.type&&(this.scrollLeft=6.5*(this.tabIndex+3));case 8:this.togglePopup("");case 9:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),videoEnd:function(){this.select_status&&(this.tabIndex++,this.playTvSrc=this.allsuccessData.vodPlayUrl[this.tabIndex].playUrl,this.videoContext.play())},fullscreenchangeback:function(e){this.isFullscreen=e.detail.fullScreen},videoPlayBack:function(){this.beginPlay=!0,e.getNetworkType({success:function(e){"wifi"!=e.networkType&&plus.nativeUI.toast("当前非WiFi环境注意流量消耗!")}})},gotoFeedback:function(){e.navigateTo({url:"../../pages/feedback/feedback"})},togglePopup:function(e){"close_bottom_share"==e&&(this.type="",this.videoToShareStatus=!1),this.type=e,this.currentCommentType=1,this.currentCommentMid=this.allsuccessData.typeId1},checkOtherContent:function(e,t,a){this.currentCommentIndex=e,this.type=a,this.currentCommentType=2,this.currentCommentId=t.commentId,this.currentCommentMid=t.commentMid,this.otherContentList=[];var s={commentContent:"",commentId:"",commentMid:"",commentName:"",commentObject:[],commentPid:"",commentTime:"",userId:"",userPortrait:""};if(s.commentContent=this.allsuccessData.commentList[e].commentContent,s.commentId=this.allsuccessData.commentList[e].commentId,s.commentMid=this.allsuccessData.commentList[e].commentMid,s.commentName=this.allsuccessData.commentList[e].commentName,s.commentPid=this.allsuccessData.commentList[e].commentPid,s.commentTime=this.allsuccessData.commentList[e].commentTime,s.userId=this.allsuccessData.commentList[e].userId,s.userPortrait=this.allsuccessData.commentList[e].userPortrait,this.otherContentList.push(s),this.allsuccessData.commentList[e].commentObject)for(var n=0;n<this.allsuccessData.commentList[e].commentObject.length;n++)this.otherContentList.push(this.allsuccessData.commentList[e].commentObject[n]);this.otherContentList.length>0?this.otherCommentListShow=!1:this.otherCommentListShow=!0},toSendComent:function(t){var a=this,s=this;1==this.currentCommentType&&(this.currentCommentId=0),e.request({url:this.websiteUrl+"/api/comment/save",method:"POST",data:{commentId:Number(this.currentCommentId),userId:Number(this.$store.state.userInfo.userId),commentName:this.$store.state.userInfo.userName,commentMid:Number(this.currentCommentMid),commentRid:Number(this.vodId),commentContent:t.inputValue},success:function(e){plus.nativeUI.toast("发表成功!");var n={commentContent:t.inputValue,commentId:e.data,commentMid:Number(a.currentCommentMid),commentName:a.$store.state.userInfo.userName,commentObject:[],commentPid:a.currentCommentId,commentTime:m.getNowTime("yyyy-MM-dd hh:mm:ss"),userId:Number(a.$store.state.userInfo.userId),userPortrait:a.$store.state.userImage.localImage};a.allsuccessData.commentNum++,1==s.currentCommentType?(s.commentData.push(n),s.commentListShow=!1):(s.commentData[a.currentCommentIndex].commentObject.push(n),a.commentListShow=!0,a.$nextTick(function(){a.commentListShow=!1}),a.otherCommentListShow=!1)}})},videoErrorCallback:function(e){this.beginPlay=!0},failShare:function(){this.sharingStatus=!0,this.togglePopup("close_bottom_share")},successShare:function(){this.sharingStatus=!0,this.togglePopup("close_bottom_share")},timeUpdateToshare:function(e){this.currentPlayTime=e.detail.currentTime,e.detail.currentTime>600&&!this.sharingStatus&&(this.videoToShareStatus=!0,this.videoContext.pause(),this.isFullscreen&&this.videoContext.exitFullScreen(),this.togglePopup("bottom_share"))},goBack:function(){e.navigateBack({delta:1,animationType:"pop-out",animationDuration:200})},bigInputFocus:function(){this.pageChangeBig=!0,e.pageScrollTo({scrollTop:0,duration:0});var t=e.getSystemInfoSync(),a=t.platform;"ios"!=a&&(this.style.allConment=t.windowHeight-e.getSystemInfoSync().screenWidth/750*1120),this.style.contentViewHeight=t.windowHeight-e.getSystemInfoSync().screenWidth/750*1220,this.style.detailViewHeight=t.windowHeight-e.getSystemInfoSync().screenWidth/750*1210,this.style.commentViewHeight=t.windowHeight-e.getSystemInfoSync().screenWidth/750*1300},bigInputBlur:function(){var t=this;this.pageChangeBig=!1,this.$refs.chatinput&&(this.$refs.chatinput.inputFocusStatus=!1),this.loadSurvey=!1,this.$nextTick(function(){t.loadSurvey=!0});var a=e.getSystemInfoSync();a.platform;this.style.contentViewHeight=a.windowHeight-e.getSystemInfoSync().screenWidth/750*660,this.style.detailViewHeight=a.windowHeight-e.getSystemInfoSync().screenWidth/750*540,this.style.commentViewHeight=a.windowHeight-e.getSystemInfoSync().screenWidth/750*750,this.style.allConment=a.windowHeight-e.getSystemInfoSync().screenWidth/750*540},toAddLike:function(){var t=this;""==this.collectionNum?e.request({url:this.websiteUrl+"/user/add/collect",method:"POST",header:{Authorization:this.$store.state.userInfo.loginToken},data:{userId:this.$store.state.userInfo.userId,vodId:Number(this.vodId),vodType:this.allsuccessData.typeId1,partsNo:Number(this.tabIndex),partsUrl:this.allsuccessData.vodPlayUrl[this.tabIndex].playUrl,playTime:"10:25"},success:function(a){1001==a.data.status?e.navigateTo({url:"../../pages/login/login"}):(t.collectionNum=a.data,t.collectionNum?(t.loadComplent=!0,t.loadSurvey=!1,t.$nextTick(function(){t.loadSurvey=!0}),plus.nativeUI.toast("收藏成功!")):plus.nativeUI.toast("收藏失败!"))}}):e.request({url:this.websiteUrl+"/user/del/collect",method:"POST",data:[Number(this.collectionNum)],success:function(e){t.collectionNum="",t.loadComplent=!1,t.loadSurvey=!1,t.$nextTick(function(){t.loadSurvey=!0}),plus.nativeUI.toast("收藏取消!")}})},toDownLoad:function(){if(this.$store.state.isLogin){var t=this.$store.state.userInfo.userId,a=this.$store.state.userInfo.loginToken,s=this;e.request({url:this.websiteUrl+"/api/exchange/permission",header:{Authorization:a},method:"GET",data:{userId:t},success:function(t){var a=t.data;0==a.status?a.userDownload>0?s.select_status?s.togglePopup("downLoad_selected_works"):s.toSendDownLoadData():(e.showToast({title:"请到兑换中心兑换下载次数",icon:"none",mask:!0}),setTimeout(function(){e.hideToast()},2e3)):1001==a.status?(e.showToast({title:a.message,icon:"none",mask:!0}),setTimeout(function(){e.hideToast(),e.navigateTo({url:"/pages/login/login",animationType:"slide-in-bottom"})},300)):(e.showToast({title:a.message,icon:"none",mask:!0}),setTimeout(function(){e.hideToast()},2e3))},fail:function(){},complete:function(){}})}else e.navigateTo({url:"/pages/login/login",animationType:"slide-in-bottom"})},toAddDownLoad:function(e){this.downIndex=e.currentTarget.id,this.toSendDownLoadData()},toSendDownLoadData:function(){var t=this,a=plus.os.name.toUpperCase();if(t.$store.state.isDown)switch(a){case"ANDROID":t.sendDownLoadToAndroid();break;case"IOS":break}else e.getNetworkType({success:function(e){if("wifi"!=e.networkType)plus.nativeUI.confirm("确定非WiFi下载?",function(e){if(0==e.index)switch(a){case"ANDROID":t.sendDownLoadToAndroid();break;case"IOS":break}},{title:"提示",buttons:["Yes","No"],verticalAlign:"center"});else switch(a){case"ANDROID":t.sendDownLoadToAndroid();break;case"IOS":break}}})},sendDownLoadToAndroid:function(){var t=this.$store.state.userInfo.userId,a=this.$store.state.userInfo.loginToken,n=plus.android.importClass("com.tjyz.video.download.TS"),o=new n;if(o.getDownload())plus.nativeUI.toast("当前已有下载任务 请稍后!");else{var i="",l=this.allsuccessData.vodPlayUrl[this.tabIndex].playUrl;this.select_status&&(i=this.allsuccessData.vodPlayUrl[this.downIndex].playName,l=this.allsuccessData.vodPlayUrl[this.downIndex].playUrl),o.getTSFile(l,this.allsuccessData.vodName,i),plus.nativeUI.toast("已添加下载队列!"),e.request({url:this.websiteUrl+"/api/download/upd",header:{Authorization:a},method:"POST",data:{userId:t},complete:function(e){console.log(s(e," at pages\\playPage\\playPage.vue:805"))}})}},sendDownLoadToIOS:function(){var t=this.$store.state.userInfo.userId,a=this.$store.state.userInfo.loginToken,n=plus.ios.importClass("downloadViewController"),o=new n,i="",l=this.allsuccessData.vodPlayUrl[this.tabIndex].playUrl;this.select_status&&(i=this.allsuccessData.vodPlayUrl[this.downIndex].playName,l=this.allsuccessData.vodPlayUrl[this.downIndex].playUrl),o.setvediomodelwithurlnamejishuimage(l,this.allsuccessData.vodName,i,this.allsuccessData.vodPic),plus.nativeUI.toast("已添加下载队列!"),e.request({url:this.websiteUrl+"/api/download/upd",header:{Authorization:a},method:"POST",data:{userId:t},complete:function(e){console.log(s(e," at pages\\playPage\\playPage.vue:835"))}})},executeSQL:function(){var e=this,t="select * from sqlite_master where name='history' and sql like '%isShare%'";plus.sqlite.selectSql({name:e.baseDateName,sql:t,success:function(t){t.length>0?(e.creatTableSQL(),console.log(s("查到数据"," at pages\\playPage\\playPage.vue:851"))):plus.sqlite.executeSql({name:e.baseDateName,sql:"drop table if exists history",success:function(t){console.log(s("删除表成功"," at pages\\playPage\\playPage.vue:857")),e.creatTableSQL()},fail:function(e){console.log(s("executeSql failed: "+JSON.stringify(e)," at pages\\playPage\\playPage.vue:861"))}})},fail:function(e){console.log(s("查找判断字段失败"," at pages\\playPage\\playPage.vue:867"))}})},creatTableSQL:function(){var e=this;plus.sqlite.executeSql({name:e.baseDateName,sql:'create table if not exists history("vodId" INT(10) PRIMARY KEY,"vodBlurb" CHAR(255),"vodName" CHAR(255),"vodPic" CHAR(255),"partsNo" INT(10),"partsUrl" CHAR(255) ,"playTime" CHAR(255),"isShare" Boolean)',success:function(t){var a="replace into history('vodId','vodBlurb','vodName','vodPic','partsNo','partsUrl','playTime','isShare') values("+e.vodId+",'"+e.allsuccessData.vodBlurb+"','"+e.allsuccessData.vodName+"','"+e.allsuccessData.vodPic+"',"+e.tabIndex+",'"+e.allsuccessData.vodPlayUrl[e.tabIndex].playUrl+"','"+e.currentPlayTime+"','false')";plus.sqlite.executeSql({name:e.baseDateName,sql:a,success:function(t){console.log(s("executeSql success!"," at pages\\playPage\\playPage.vue:885")),e.closeDB()},fail:function(e){console.log(s("executeSql failed: "+JSON.stringify(e)," at pages\\playPage\\playPage.vue:889"))}})},fail:function(e){console.log(s("executeSql failed: "+JSON.stringify(e)," at pages\\playPage\\playPage.vue:894"))}})},selectSQL:function(){var e=this;plus.sqlite.selectSql({name:e.baseDateName,sql:"select * from  history",success:function(t){console.log(s("selectSql success: "," at pages\\playPage\\playPage.vue:907")),e.closeDB()},fail:function(t){e.closeDB(),console.log(s("selectSql failed: "+JSON.stringify(t)," at pages\\playPage\\playPage.vue:912"))}})},closeDB:function(){var e=this;plus.sqlite.closeDatabase({name:e.baseDateName,success:function(e){console.log(s("closeDatabase success!"," at pages\\playPage\\playPage.vue:924"))},fail:function(e){console.log(s("closeDatabase failed: "+JSON.stringify(e)," at pages\\playPage\\playPage.vue:927"))}})},checkIShareStatus:function(e){var t=this;plus.sqlite.isOpenDatabase({name:t.baseDateName,path:t.baseDataSrc})?t.executCheckShare(e):plus.sqlite.openDatabase({name:t.baseDateName,path:t.baseDataSrc,success:function(a){console.log(s("openDatabase success!"," at pages\\playPage\\playPage.vue:941")),t.executCheckShare(e)},fail:function(e){console.log(s("openDatabase failed: "+JSON.stringify(e)," at pages\\playPage\\playPage.vue:945"))}})},executCheckShare:function(e){var t=this;plus.sqlite.selectSql({name:t.baseDateName,sql:"select * from  history where vodId= "+this.vodId,success:function(a){e(JSON.stringify(a)),t.closeDB()},fail:function(a){e(),t.closeDB(),console.log(s("selectSql failed: "+JSON.stringify(a)," at pages\\playPage\\playPage.vue:966"))}})},toShare:function(){var t=this,a={href:"http://120.27.228.13:8080/download_page/download.html",title:'幻影国际，随时随地抢"鲜"看！',desc:"精彩大片抢先看",imgUrl:"/static/huanying_code.png"},n=this;this.shareObj=(0,o.default)(a,function(t){console.log(s("点击按钮的序号: "+t," at pages\\playPage\\playPage.vue:985"));var o={href:a.href||"",title:a.title||"",summary:a.desc||"",success:function(e){console.log(s("success:"+JSON.stringify(e)," at pages\\playPage\\playPage.vue:991")),n.$nextTick(function(){n.shareObj.alphaBg.hide(),n.shareObj.shareMenu.hide()})},fail:function(e){console.log(s("fail:"+JSON.stringify(e)," at pages\\playPage\\playPage.vue:998")),n.$nextTick(function(){n.shareObj.alphaBg.hide(),n.shareObj.shareMenu.hide()})}};switch(t){case 0:o.provider="weixin",o.scene="WXSceneSession",o.type=0,o.imageUrl=a.imgUrl||"",e.share(o);break;case 1:o.provider="weixin",o.scene="WXSenceTimeline",o.type=0,o.imageUrl=a.imgUrl||"",e.share(o);break;case 2:o.provider="qq",o.type=1,o.imageUrl=a.imgUrl||"",e.share(o);break;case 3:e.setClipboardData({data:a.href,complete:function(){e.showToast({title:"已复制到剪贴板"})}});break;case 4:plus.share.sendWithSystem({type:"web",title:a.title||"",thumbs:[a.imgUrl||""],href:a.href||"",content:a.desc||""});break}}),this.$nextTick(function(){t.shareObj.alphaBg.show(),t.shareObj.shareMenu.show()})},toLogin:function(){this.videoContext.pause()}}};t.default=p}).call(this,a("6e42")["default"],a("0de9")["default"])},"7e8b":function(e,t,a){},"9a04":function(e,t,a){"use strict";a.r(t);var s=a("4101"),n=a("0527");for(var o in n)"default"!==o&&function(e){a.d(t,e,function(){return n[e]})}(o);a("e7f7");var i=a("2877"),l=Object(i["a"])(n["default"],s["a"],s["b"],!1,null,null,null);t["default"]=l.exports},e08e:function(e,t,a){"use strict";(function(e){a("c5e3"),a("921b");s(a("66fd"));var t=s(a("9a04"));function s(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,a("6e42")["createPage"])},e7f7:function(e,t,a){"use strict";var s=a("7e8b"),n=a.n(s);n.a}},[["e08e","common/runtime","common/vendor"]]]);